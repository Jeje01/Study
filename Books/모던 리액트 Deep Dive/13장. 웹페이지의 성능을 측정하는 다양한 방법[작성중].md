# 13.1 애플리케이션에서 확인하기

## 13.1.1 create-react-app

- reportWebVitals 함수 : 웹에서 성능을 측정하기 위한 함수
- 각각 CLS, FID, FCP, LCP, TTFB를 측정함
- 자바스크립트 수준의 라이브러리가 브라우저의 웹페이지 성능을 측정할 수 있는 이유는 PerformanceObserver API 덕분
- 서버 등 어딘가에 기록하고 싶을 때
    - 소량의 분석용 데이터를 전송하기 위해 만들어진 senBeacon API나 fetch 등의 API를 사용해 임의의 서버로 정보를 보냄
    - 구글 애널리틱스로 보낼 수도 있음

## 13.1.2 create-next-app

- Next.js는 성능 측정을 할 수 있는 메서드인 NextWebVitalsMetric을 제공함
- 핵심 웹 지표 외에 다음과 같은 Next.js에 특화된 사용자 지표도 제공함
    - `Next.js-hydration` : 페이지가 서버 사이드에서 렌더링되어 하이드레이션하는 데 걸린 시간
    - `Next.js-route-change-to-render` : 페이지가 경로 변경 후 페이지 렌더링 시작에 걸리는 시간
    - `Next.js-render` : 경로 변경이 완료된 후 페이지를 렌더링하는 데 걸린 시간
- Next.js는 최초에 SSR을 수행하기 때문에 필연적으로 리액트의 하이드레이션 작업이 뒤따름

# 13.2 구글 라이트하우스

- 구글에서 제공하는 웹 페이지 성능 측정 도구로, 오픈소스로 운영되고 있음
- 크롬에 설치된 다른 확장 프로그램 등이 영향을 줄 수 있으므로 가급적 시크릿 창으로 실행해 확인하는 것을 권장함

## 13.2.1 구글 라이트하우스 - 탐색 모드

- 페이지에 접속했을 때부터 페이지 로딩이 완료될 때까지의 성능을 측정하는 모드

### 성능

- 웹페이지의 성능 관련 지표 확인 영역
- FCP, LCP, CLS 외에도 3가지 추가 지표
    - `Time to Interactive`: 상호작용에 걸리는 시간
    - `Speed Index` : 페이지가 로드되는 동안 콘텐츠가 얼마나 빨리 시작적으로 표시되는지를 계산함
    - `Total Blocking Time`
        - 메인 스레드에서 특정 시간 이상 진행되는 작업이 수행될 때마다 메인 스레드가 차단된 것으로 간주함
        - 긴 작업을 모아서 Total Blocking Time(총 차단 시간)이라고 함
        - 최초에 사용자에게 무언가 콘텐츠를 보여줬을 때(FCP)부터 상호 작용까지 걸리는 시간(TTI) 사이의 작업만 대상으로 함

### 접근성

- `웹 접근성` : 장애인 및 고령자 등 신체적으로 불편한 사람들이 일반적인 사용자와 동등하게 웹페이지를 이용할 수 있도록 보장하는 것
- `오디오와 비디오` : 자막이 필요함
- 마우스 활용 불가 상황에 대비해 키보드만으로 모든 콘텐츠에 접근 가능해야 함
- `접근성` : 다양한 사용자를 배려하기 위해 HTML과 CSS 등에 적절한 대안을 삽입하는 것

### 권장사항

- `권장사항` : 보안, 표준 모드, 최신 라이브러리, 소스 맵 등
    - CSP가 XSS 공격에 효과적인지 확인
        - XSS (Cross Site Scripting)
            - 개발자가 아닌 제3자가 삽입한 스크립트를 통해 공격하는 기법
            - 게시판이 있고, 악의적인 게시자가 내용 스크립트를 작성하는 경우 개발자가 별다른 조치를 취하지 않으면 이 스크립트가 실행되어 사용자에게 위해가 되는 작업 수행 가능
        - CSP (Content Security Policy)
            - 웹 사이트에서 호출할 수 있는 컨텐츠를 제한하는 정책
            - 이미지, 스타일, 스크립트와 같은 정적인 콘텐츠뿐만 아니라 주소, 도메인 등 정보도 포함
    - 감지된 JavaScript 라이브러리
        - jQuery, Next.js, React, Lodash, create-react-app 등이 나타남
    - HTTPS 사용
    - 페이지 로드 위치정보 권한 요청 방지하기
    - 알려진 보안 취약점이 있는 프런트엔드 자바스크립트 라이브러리를 사용하지 않음
    - 사용자가 비밀번호 입력란에 붙여넣을 수 있도록 허용
    - 이미지를 올바른 가로세로 비율로 표시
    - 이미지가 적절한 해상도로 제공됨
    - 페이지에 HTML DocType 있음
    - 문자 집합을 제대로 정의함
    - 지원 중간 API 사용하지 않기
    - 콘솔에 로그된 브라우저 오류 없음
    - Chrome Devtools의 Issues 패널에 문제없음
    - 페이지에 유효한 소스 맵이 있음
    - font-display

### 검색 엔진 최적화

- 검색엔진이 쉽게 웹페이지 정보를 가져가서 공개할 수 있도록 최적화돼 있는지를 확인
    - 크롤링하기 쉽게 만들었는지
    - robots.txt가 유효한지
    - 이미지와 링크에 설명 문자가 존재하는지
    - <meta>나 <title> 등으로 페이지의 정보를 빠르게 확인할 수 있는지 등을 확인

## 13.2.2 구글 라이트하우스 - 기간 모드

- 실제 웹페이지를 탐색하는 동안 지표를 측정
- 앞에서 볼 수 없었던 두 가지 : 흔적과 트리맵

### 흔적

- View Trace를 번역한 것
- 시간의 흐름에 따라 어떻게 웹페이지가 로딩됐는지 보여줌

### 트리맵

- 페이지를 불러올 때 함께 로딩한 모든 리소스를 함께 모아서 볼 수 있는 곳
- 로딩한 리소스에서 사용하지 않은 바이트의 크기도 확인 가능

## 13.2.3 구글 라이트하우스 - 스냅샷

- 탐색 모드와 매우 유사하지만 현재 페이지 상태를 기준으로 분석한다는 점이 다름
- 현재 상태에서 검색엔진의 최적화, 접근성, 성능 등을 분석 가능

# 13.3 WebPageTest

- 웹사이트 성능을 분석하는 도구로 가장 널리 알려진 도구
- WebPageTest에서 제공하는 분석 도구
    - `Site Performance`
    - `Core Web Vitals`
    - `Lighthouse`
    - `Visual Comparison` : 2개 이상의 사이트를 동시에 실행해 시간의 흐름에 따른 로딩 과정을 비교
    - `Traceroute` : 네트워크 경로를 확인하는 도구
- 거리가 먼 서버를 기준으로 테스트하기 때문에 크롬 개발자 도구에서 테스트했을 때보다 성능 지표가 좋지 않을 가능성이 매우 높음

## 13.3.1 Performace Summary

- 크게 세 가지 영역
    - Opportunities & Experiments
        - Is it Quick
        - Is it Usable
        - Is it Resilient
    - Observed Metrics
    - Individual Runs : 3번의 테스트를 돌려서 평균값을 보여주는데, 각 실행별로 어떠한 결과를 보여주는지 확인 가능

## 13.3.2 Opportunities & Experiments

- 최초 바이트까지의 시간(TTFB)을 점검
- 렌더링을 블로킹하는 자바스크립트가 있는지 확인
- 렌더링을 블로킹하는 CSS가 있는지 확인
- 최초 콘텐츠풀 페인트가 2.5초 이내인지 확인
- 주요 영역 내에 게으른 로딩되는 이미지가 있는지 확인
- 주요 영역 외에 이미지가 게으르게 로딩되는지 확인
- 문자의 노출을 지연시키는 커스텀 폰트가 있는지 확인
- 제3자 호스트에서 폰트를 불러오는지 확인
- 실제로 사용하지 않는 리소스를 rel=preload로 불러오지 않는지 확인
- HTTP 리다이렉트되는 리소스가 없어야 함
- 최초로 다운로드받은 HTML과 최종 결과물 HTML 사이에 크기 차이가 적어야 함

## 13.3.3 Filmstrip

- 필름을 보는 것처럼 시간의 흐름에 따라 어떻게 웹사이트가 그려졌는지, 또 이때 어떤 리소스가 불어와졌는지 볼 수 있는 메뉴

## 13.3.4 Details

- Filmstrip에서 보여준 내용을 자세하게 보여주는 영역

## 13.3.5 Web Vitals

- LCP(Largest Contentful Paint), CLS(Cumulative Layout Shift), TBT(Total Blocking Time)에 대한 자세한 내용 확인 가능

## 13.3.6 Optimizations

- 리소스들이 얼마나 최적화돼 있는지 나타냄

## 13.3.7 Content

- 웹사이트에서 제공하는 컨텐츠, 애셋을 종류별로 묶어 통계를 보여줌
- 종류별 크기와 로딩 과정 확인 가능
- 렌더링을 거치면서 또 어떻게 애셋을 불러오는지도 확인 가능

## 13.3.8 Domains

- 애셋들이 어느 도메인에서 왔는지를 도메인별로 묶어서 확인 가능

## 13.3.9 Console Log

- 웹페이지에 접속했을 때 console.log로 무엇이 기록됐는지 확인 가능

## 13.3.10 Detected Technologies

- 웹사이트를 개발하는 데 사용된 기술을 확인할 수 있는 메뉴

## 13.3.11 Main-thread Processing

- 하위 항목인 Processing Breakdown에서는 메인 스레드가 어떤 작업을 처리했는지 확인 가능

## 13.3.12 Lighthouse Report

- 라이트하우스 도구와 다른 점 : 개발자의 브라우저가 아닌 원격지의 다소 일반적인 모바일 기기의 브라우저에서 측정됨

## 13.3.13 기타

- WebPageTest 외부에서 제공하는 서비스
    - Image Analysis
    - Request Map
    - Data Cost
    - Security Score
